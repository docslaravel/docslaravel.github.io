<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	<title>HTTP Middleware - Laravel document offline</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="author" content="Taylor Otwell">
	<meta name="description" content="Laravel document offline">
	<meta name="keywords" content="laravel, php, framework, document, offline">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--[if lte IE 9]>
		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link rel="stylesheet" href="../assets/css/laravel.css">
</head>
<body class="docs language-php scotchified">

<div class="responsive-sidebar-nav" id="responsive-sidebar-nav-1"> 
	<a href="#" class="toggle-slide menu-link btn">
		<span class="sr-only">Menu</span>
	</a>
</div>
<div class="scotch-panel-wrapper" id="scotch_panel_wrapper">
	<div class="scotch-panel-canvas" id="scotch_panel_canvas">

		<span class="overlay"></span>

		<nav class="main">
			<div class="container">
				<a href="/" class="brand">
					<img src="../assets/img/laravel-logo.png" height="30">
					Laravel docs
				</a>

				<div class="responsive-sidebar-nav">
					<a href="#" class="toggle-slide menu-link btn">
						<span class="sr-only">Open</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
				</div>

				<div class="switcher">
					<div class="dropdown">
						<button class="btn dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">5.0
							<span class="caret"></span>
						</button>
					</div>
				</div>
			</div>
		</nav>

		<nav id="slide-menu" class="slide-menu scotch-panel-left" role="navigation">
		
			<div class="brand">
				<a href="/">
					<img src="../assets/img/laravel-logo-white.png" height="50">
				</a>
			</div>

			<div class="slide-docs-nav">
				<h2>Documentation</h2>
				<ul>
					<li>Prologue
						<ul>
							<li><a href="../releases/">Release Notes</a></li>
							<li><a href="../upgrade/">Upgrade Guide</a></li>
							<li><a href="../contributions/">Contribution Guide</a></li>
						</ul>
					</li>
					<li>Setup
						<ul>
							<li><a href="../installation/">Installation</a></li>
							<li><a href="../configuration/">Configuration</a></li>
							<li><a href="../homestead/">Homestead</a></li>
						</ul>
					</li>
					<li>The Basics
						<ul>
							<li><a href="../routing/">Routing</a></li>
							<li><a href="../middleware/">Middleware</a></li>
							<li><a href="../controllers/">Controllers</a></li>
							<li><a href="../requests/">Requests</a></li>
							<li><a href="../responses/">Responses</a></li>
							<li><a href="../views/">Views</a></li>
						</ul>
					</li>
					<li>Architecture Foundations
						<ul>
							<li><a href="../providers/">Service Providers</a></li>
							<li><a href="../container/">Service Container</a></li>
							<li><a href="../contracts/">Contracts</a></li>
							<li><a href="../facades/">Facades</a></li>
							<li><a href="../lifecycle/">Request Lifecycle</a></li>
							<li><a href="../structure/">Application Structure</a></li>
						</ul>
					</li>
					<li>Services
						<ul>
							<li><a href="../authentication/">Authentication</a></li>
							<li><a href="../billing/">Billing</a></li>
							<li><a href="../cache/">Cache</a></li>
							<li><a href="../collections/">Collections</a></li>
							<li><a href="../bus/">Command Bus</a></li>
							<li><a href="../extending/">Core Extension</a></li>
							<li><a href="../elixir/">Elixir</a></li>
							<li><a href="../encryption/">Encryption</a></li>
							<li><a href="../envoy/">Envoy</a></li>
							<li><a href="../errors/">Errors &amp; Logging</a></li>
							<li><a href="../events/">Events</a></li>
							<li><a href="../filesystem/">Filesystem / Cloud Storage</a></li>
							<li><a href="../hashing/">Hashing</a></li>
							<li><a href="../helpers/">Helpers</a></li>
							<li><a href="../localization/">Localization</a></li>
							<li><a href="../mail/">Mail</a></li>
							<li><a href="../packages/">Package Development</a></li>
							<li><a href="../pagination/">Pagination</a></li>
							<li><a href="../queues/">Queues</a></li>
							<li><a href="../session/">Session</a></li>
							<li><a href="../templates/">Templates</a></li>
							<li><a href="../testing/">Unit Testing</a></li>
							<li><a href="../validation/">Validation</a></li>
						</ul>
					</li>
					<li>Database
						<ul>
							<li><a href="../database/">Basic Usage</a></li>
							<li><a href="../queries/">Query Builder</a></li>
							<li><a href="../eloquent/">Eloquent ORM</a></li>
							<li><a href="../schema/">Schema Builder</a></li>
							<li><a href="../migrations/">Migrations &amp; Seeding</a></li>
							<li><a href="../redis/">Redis</a></li>
						</ul>
					</li>
					<li>Artisan CLI
						<ul>
							<li><a href="../artisan/">Overview</a></li>
							<li><a href="../commands/">Development</a></li>
						</ul>
					</li>
				</ul>
			</div>
		</nav>

		<div class="docs-wrapper container">

			<section class="sidebar">
				<ul>
					<li>Prologue
						<ul>
							<li><a href="../releases/">Release Notes</a></li>
							<li><a href="../upgrade/">Upgrade Guide</a></li>
							<li><a href="../contributions/">Contribution Guide</a></li>
						</ul>
					</li>
					<li>Setup
						<ul>
							<li><a href="../installation/">Installation</a></li>
							<li><a href="../configuration/">Configuration</a></li>
							<li><a href="../homestead/">Homestead</a></li>
						</ul>
					</li>
					<li>The Basics
						<ul>
							<li><a href="../routing/">Routing</a></li>
							<li><a href="../middleware/">Middleware</a></li>
							<li><a href="../controllers/">Controllers</a></li>
							<li><a href="../requests/">Requests</a></li>
							<li><a href="../responses/">Responses</a></li>
							<li><a href="../views/">Views</a></li>
						</ul>
					</li>
					<li>Architecture Foundations
						<ul>
							<li><a href="../providers/">Service Providers</a></li>
							<li><a href="../container/">Service Container</a></li>
							<li><a href="../contracts/">Contracts</a></li>
							<li><a href="../facades/">Facades</a></li>
							<li><a href="../lifecycle/">Request Lifecycle</a></li>
							<li><a href="../structure/">Application Structure</a></li>
						</ul>
					</li>
					<li>Services
						<ul>
							<li><a href="../authentication/">Authentication</a></li>
							<li><a href="../billing/">Billing</a></li>
							<li><a href="../cache/">Cache</a></li>
							<li><a href="../collections/">Collections</a></li>
							<li><a href="../bus/">Command Bus</a></li>
							<li><a href="../extending/">Core Extension</a></li>
							<li><a href="../elixir/">Elixir</a></li>
							<li><a href="../encryption/">Encryption</a></li>
							<li><a href="../envoy/">Envoy</a></li>
							<li><a href="../errors/">Errors &amp; Logging</a></li>
							<li><a href="../events/">Events</a></li>
							<li><a href="../filesystem/">Filesystem / Cloud Storage</a></li>
							<li><a href="../hashing/">Hashing</a></li>
							<li><a href="../helpers/">Helpers</a></li>
							<li><a href="../localization/">Localization</a></li>
							<li><a href="../mail/">Mail</a></li>
							<li><a href="../packages/">Package Development</a></li>
							<li><a href="../pagination/">Pagination</a></li>
							<li><a href="../queues/">Queues</a></li>
							<li><a href="../session/">Session</a></li>
							<li><a href="../templates/">Templates</a></li>
							<li><a href="../testing/">Unit Testing</a></li>
							<li><a href="../validation/">Validation</a></li>
						</ul>
					</li>
					<li>Database
						<ul>
							<li><a href="../database/">Basic Usage</a></li>
							<li><a href="../queries/">Query Builder</a></li>
							<li><a href="../eloquent/">Eloquent ORM</a></li>
							<li><a href="../schema/">Schema Builder</a></li>
							<li><a href="../migrations/">Migrations &amp; Seeding</a></li>
							<li><a href="../redis/">Redis</a></li>
						</ul>
					</li>
					<li>Artisan CLI
						<ul>
							<li><a href="../artisan/">Overview</a></li>
							<li><a href="../commands/">Development</a></li>
						</ul>
					</li>
				</ul>
			</section>

			<article>
				
<h1>HTTP Middleware</h1>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-middleware">Defining Middleware</a></li>
<li><a href="#registering-middleware">Registering Middleware</a></li>
<li><a href="#terminable-middleware">Terminable Middleware</a></li>
</ul>
<p><a name="introduction"></a></p>
<h2><a href="#introduction">Introduction</a></h2>
<p>HTTP middleware provide a convenient mechanism for filtering HTTP requests entering your application. For example, Laravel includes a middleware that verifies the user of your application is authenticated. If the user is not authenticated, the middleware will redirect the user to the login screen. However, if the user is authenticated, the middleware will allow the request to proceed further into the application.</p>
<p>Of course, middleware can be written to perform a variety of tasks besides authentication. A CORS middleware might be responsible for adding the proper headers to all responses leaving your application. A logging middleware might log all incoming requests to your application.</p>
<p>There are several middleware included in the Laravel framework, including middleware for maintenance, authentication, CSRF protection, and more. All of these middleware are located in the <code class=" language-php">app<span class="token operator">/</span>Http<span class="token operator">/</span>Middleware</code> directory.</p>
<p><a name="defining-middleware"></a></p>
<h2><a href="#defining-middleware">Defining Middleware</a></h2>
<p>To create a new middleware, use the <code class=" language-php">make<span class="token punctuation">:</span>middleware</code> Artisan command:</p>
<pre class=" language-php"><code class=" language-php">php artisan make<span class="token punctuation">:</span>middleware OldMiddleware</code></pre>
<p>This command will place a new <code class=" language-php">OldMiddleware</code> class within your <code class=" language-php">app<span class="token operator">/</span>Http<span class="token operator">/</span>Middleware</code> directory. In this middleware, we will only allow access to the route if the supplied <code class=" language-php">age</code> is greater than 200. Otherwise, we will redirect the users back to the "home" URI.</p>
<pre class=" language-php"><code class=" language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">OldMiddleware</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">/**
     * Run the request filter.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Closure  $next
     * @return mixed
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle<span class="token punctuation">(</span></span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">input<span class="token punctuation">(</span></span><span class="token string">'age'</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">200</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">redirect<span class="token punctuation">(</span></span><span class="token string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<p>As you can see, if the given <code class=" language-php">age</code> is less than <code class=" language-php"><span class="token number">200</span></code>, the middleware will return an HTTP redirect to the client; otherwise, the request will be passed further into the application. To pass the request deeper into the application (allowing the middleware to "pass"), simply call the <code class=" language-php"><span class="token variable">$next</span></code> callback with the <code class=" language-php"><span class="token variable">$request</span></code>.</p>
<p>It's best to envision middleware as a series of "layers" HTTP requests must pass through before they hit your application. Each layer can examine the request and even reject it entirely.</p>
<h3><em>Before</em> / <em>After</em> Middleware</h3>
<p>Whether a middleware runs before or after a request depends on the middleware itself. This middleware would perform some task <strong>before</strong> the request is handled by the application:</p>
<pre class=" language-php"><code class=" language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">BeforeMiddleware</span> <span class="token keyword">implements</span> <span class="token class-name">Middleware</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle<span class="token punctuation">(</span></span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
       <span class="token comment" spellcheck="true"> // Perform action
</span>
        <span class="token keyword">return</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>However, this middleware would perform its task <strong>after</strong> the request is handled by the application:</p>
<pre class=" language-php"><code class=" language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AfterMiddleware</span> <span class="token keyword">implements</span> <span class="token class-name">Middleware</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle<span class="token punctuation">(</span></span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment" spellcheck="true"> // Perform action
</span>
        <span class="token keyword">return</span> <span class="token variable">$response</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><a name="registering-middleware"></a></p>
<h2><a href="#registering-middleware">Registering Middleware</a></h2>
<h3>Global Middleware</h3>
<p>If you want a middleware to be run during every HTTP request to your application, simply list the middleware class in the <code class=" language-php"><span class="token variable">$middleware</span></code> property of your <code class=" language-php">app<span class="token operator">/</span>Http<span class="token operator">/</span>Kernel<span class="token punctuation">.</span>php</code> class.</p>
<h3>Assigning Middleware To Routes</h3>
<p>If you would like to assign middleware to specific routes, you should first assign the middleware a short-hand key in your <code class=" language-php">app<span class="token operator">/</span>Http<span class="token operator">/</span>Kernel<span class="token punctuation">.</span>php</code> file. By default, the <code class=" language-php"><span class="token variable">$routeMiddleware</span></code> property of this class contains entries for the middleware included with Laravel. To add your own, simply append it to this list and assign it a key of your choosing.</p>
<p>Once the middleware has been defined in the HTTP kernel, you may use the <code class=" language-php">middleware</code> key in the route options array:</p>
<pre class=" language-php"><code class=" language-php"><span class="token scope">Route<span class="token punctuation">::</span></span><span class="token function">get<span class="token punctuation">(</span></span><span class="token string">'admin/profile'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'middleware'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'auth'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true"> //
</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><a name="terminable-middleware"></a></p>
<h2><a href="#terminable-middleware">Terminable Middleware</a></h2>
<p>Sometimes a middleware may need to do some work after the HTTP response has already been sent to the browser. For example, the "session" middleware included with Laravel writes the session data to storage <em>after</em> the response has been sent to the browser. To accomplish this, you may define the middleware as "terminable".</p>
<pre class=" language-php"><code class=" language-php"><span class="token keyword">use</span> <span class="token package">Closure</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Routing<span class="token punctuation">\</span>TerminableMiddleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">StartSession</span> <span class="token keyword">implements</span> <span class="token class-name">TerminableMiddleware</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle<span class="token punctuation">(</span></span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">terminate<span class="token punctuation">(</span></span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$response</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
       <span class="token comment" spellcheck="true"> // Store the session data...
</span>    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<p>As you can see, in addition to defining a <code class=" language-php">handle</code> method, <code class=" language-php">TerminableMiddleware</code> define a <code class=" language-php">terminate</code> method. This method receives both the request and the response. Once you have defined a terminable middleware, you should add it to the list of global middlewares in your HTTP kernel.</p>

			</article>
		</div>

		<footer class="main">
			
			<p>Laravel is a trademark of Taylor Otwell. Copyright © Taylor Otwell.</p>
			<p class="less-significant"><a href="http://jackmcdade.com/">Design by Jack McDade</a></p>
			<p>Edit by ngnam</p>
		</footer>

		<script src="../assets/js/laravel.js"></script>
		<script src="../assets/js/viewport-units-buggyfill.js"></script>
		<script src="../assets/js/affix.js"></script>
		<script>window.viewportUnitsBuggyfill.init();</script>
<script src="../assets/js/sidebar-scroll.js"></script>

	   	<p style="transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); margin: 0px;"></p>

	</div>
</div><div class="scroll_top"></div>
</body></html>